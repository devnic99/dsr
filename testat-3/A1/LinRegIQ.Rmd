---
title: "Lineare Regression (IQ)"
output: html_document
---

```{r echo = F, warning = F, message = F}
# Laden Sie benötigte Libraries...
library("caret")
```

# Vorhersage des IQ mit linearer Regression

In dieser Aufgabe soll mittels linearer Regression der Intelligenz-Quotient (IQ) von Kindern vorhergesagt werden.

## Daten importieren und anschauen

Laden Sie die Daten unter https://oc.informatik.hs-mannheim.de/s/K2nJQngd8N6o3M5/download in einen Data Frame. Die Daten sind im RDS-Format gespeichert. Der Datensatz stammt von Martin Brand (brandt@psychologie.uni-mannheim.de, https://www.sowi.uni-mannheim.de/kuhlmann/team/akademische-mitarbeiterinnen-und-mitarbeiter/brandt-martin/). Die Spalten bedeuten:

 * `id`: Eindeutige Nummer
 * `IQ.mother`: IQ der Mutter
 * `IQ.father`: IQ des Vaters
 * `n.siblings`: Anzahl der Geschwister
 * `IQ.child`: IQ des Kindes

```{r}
# Ihre Lösung:
data <- readRDS(url("https://oc.informatik.hs-mannheim.de/s/K2nJQngd8N6o3M5/download"))
data <- data.frame(data)
head(data)
```

Verschaffen Sie sich einen ersten Überblick über die Daten. Plotten Sie dazu ein Mehrfach-Diagramm, das Scatterplots aller vier Variablen (drei Merkmale und Response `IQ.child`) untereinander zeigt. D.h. jede Variable soll mit jeder anderen paarweise verglichen werden.

Tipp: Mit der `caret::featurePlot`-Funktion lässt sich das gut erreichen.

```{r}
# Ihre Lösung:
featurePlot(
    x = data[, 2:4], # IQ Mutter, Vater, Anzahl Geschwister
    y = data[, 5], # IQ des Kindes
    plot = "pairs",
)
```

## Lineare Regression

Wenden Sie für diesen Datensatz eine lineare Regression an, um den IQ von Kindern in Abhängigkeit der Merkmale schätzen zu können. Die lineare Regression soll im Objekt `lm.iq` gespeichert werden.

```{r}
# Ihre Lösung:
lm.iq <- lm(IQ.child ~ ., data = data[, 2:5])
s <- summary(lm.iq)
s
```


### Merkmale

Welche Merkmale spielen eine Rolle? Interpretieren Sie das Ergebnis.

```{r}
# Ihre Lösung:
r_squared <- function(x, y) cor(x, y)^2

for (i in 2:4) {
    r2 <- r_squared(data[, i], data[, 5])
    print(paste0(colnames(data)[i], ": ", r2))
}

# Größte Rolle spielt der IQ der Mutter
```


### RSE

Berechnen Sie den RSE. Was gibt dieser an?

```{r}
# Ihre Lösung:
rse <- s$sigma
rse # gibt die Standardabweichung der Residuen an
```

### Anteil erklärter Varianz

Wie groß (in Prozent) ist der Anteil der erklärten Varianz? Ist das Ergebnis zufriedenstellend?

```{r}
# Ihre Lösung:
```

## Geschwister-Anzahl als Faktor

### Anwendung

Wandeln Sie den Datensatz so um, dass die Anzahl der Geschwister (`n.siblings`) ein Faktor ist und wenden Sie darauf die lineare Regression an.

```{r}
# Ihre Lösung:
data$n.siblings <- as.factor(data$n.siblings)
lm.iq_factor <- lm(IQ.child ~ ., data = data[, 2:5])
s_factor <- summary(lm.iq_factor)
s_factor
```

### $R^2$

$R^2$ hat sich verändert. Interpretieren bzw. begründen Sie das Ergebnis:


## Schätzung für Testdaten

Abschließend soll mittels Cross-Validation überprüft werden, wie gut dieses Verfahren für unbekannte Testdaten funktioniert. Überlegen Sie sich ein passendes Verfahren und bestimmen Sie damit die $R^2$-Statistik.

```{r}
# Ihre Lösung:
kfcv <- trainControl(
    method = "cv", # k-fold cross validation
    number = 5, # n folds
    returnResamp = "all"
)

class.fit <- train(IQ.child ~ .,
    data = data[, 2:5],
    method = "lm", # linear model
    trControl = kfcv
)
r2 <- class.fit$results$Rsquared
r2
```



